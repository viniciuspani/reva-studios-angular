<div class="reset-password-container">
  <p-toast />
  
  <div class="reset-password-card">
    <p-card>
      <ng-template pTemplate="header">
        <div class="card-header">
          <i class="pi pi-lock"></i>
          <h2>{{ languageService.t('resetPassword') }}</h2>
        </div>
      </ng-template>

      <!-- Etapa 1: Solicitar código via email -->
      @if (step() === 'email') {
        <form [formGroup]="emailForm" (ngSubmit)="sendCode()">
          <div class="form-content">
            <p class="description">
              {{ languageService.t('resetPasswordDescription') }}
            </p>

            <div class="field">
              <label for="email">{{ languageService.t('email') }}</label>
              <input 
                pInputText 
                id="email" 
                formControlName="email"
                type="email"
                [placeholder]="languageService.t('enterEmail')"
                class="w-full"
              />
              @if (emailForm.get('email')?.invalid && emailForm.get('email')?.touched) {
                <small class="p-error">
                  {{ languageService.t('invalidEmail') }}
                </small>
              }
            </div>

            <div class="button-group">
              <p-button 
                type="submit"
                [label]="languageService.t('sendCode')"
                icon="pi pi-send"
                [loading]="loading()"
                [disabled]="emailForm.invalid"
                styleClass="w-full"
              />
              
              <p-button 
                type="button"
                [label]="languageService.t('backToLogin')"
                icon="pi pi-arrow-left"
                severity="secondary"
                [text]="true"
                (onClick)="backToLogin()"
                styleClass="w-full"
              />
            </div>
          </div>
        </form>
      }

      <!-- Etapa 2: Validar código de verificação -->
      @if (step() === 'code') {
        <form [formGroup]="codeForm" (ngSubmit)="verifyCode()">
          <div class="form-content">
            <p class="description">
              {{ languageService.t('enterCodeSent') }} <strong>{{ email() }}</strong>
            </p>

            <div class="field">
              <label for="code">{{ languageService.t('verificationCode') }}</label>
              <input 
                pInputText 
                id="code" 
                formControlName="code"
                type="text"
                maxlength="6"
                [placeholder]="languageService.t('enterCode')"
                class="w-full code-input"
              />
              @if (codeForm.get('code')?.invalid && codeForm.get('code')?.touched) {
                <small class="p-error">
                  {{ languageService.t('codeRequired') }}
                </small>
              }
            </div>

            <div class="button-group">
              <p-button 
                type="submit"
                [label]="languageService.t('verifyCode')"
                icon="pi pi-check"
                [loading]="loading()"
                [disabled]="codeForm.invalid"
                styleClass="w-full"
              />
              
              <p-button 
                type="button"
                [label]="languageService.t('back')"
                icon="pi pi-arrow-left"
                severity="secondary"
                [text]="true"
                (onClick)="goBack()"
                styleClass="w-full"
              />
            </div>
          </div>
        </form>
      }

      <!-- Etapa 3: Definir nova senha -->
      @if (step() === 'password') {
        <form [formGroup]="passwordForm" (ngSubmit)="resetPassword()">
          <div class="form-content">
            <p class="description">
              {{ languageService.t('enterNewPassword') }}
            </p>

            <div class="field">
              <label for="password">{{ languageService.t('newPassword') }}</label>
              <p-password 
                id="password"
                formControlName="password"
                [placeholder]="languageService.t('enterPassword')"
                [toggleMask]="true"
                [feedback]="true"
                styleClass="w-full"
                inputStyleClass="w-full"
              />
              @if (passwordForm.get('password')?.invalid && passwordForm.get('password')?.touched) {
                <small class="p-error">
                  {{ languageService.t('passwordMinLength') }}
                </small>
              }
            </div>

            <div class="field">
              <label for="confirmPassword">{{ languageService.t('confirmPassword') }}</label>
              <p-password 
                id="confirmPassword"
                formControlName="confirmPassword"
                [placeholder]="languageService.t('confirmPassword')"
                [toggleMask]="true"
                [feedback]="false"
                styleClass="w-full"
                inputStyleClass="w-full"
              />
              @if (passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched) {
                <small class="p-error">
                  {{ languageService.t('passwordsDoNotMatch') }}
                </small>
              }
            </div>

            <div class="button-group">
              <p-button 
                type="submit"
                [label]="languageService.t('resetPassword')"
                icon="pi pi-check"
                [loading]="loading()"
                [disabled]="passwordForm.invalid"
                styleClass="w-full"
              />
              
              <p-button 
                type="button"
                [label]="languageService.t('back')"
                icon="pi pi-arrow-left"
                severity="secondary"
                [text]="true"
                (onClick)="goBack()"
                styleClass="w-full"
              />
            </div>
          </div>
        </form>
      }
    </p-card>
  </div>
</div>